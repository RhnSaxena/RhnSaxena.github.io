<html>

<head>
    <title></title>
</head>

<body onload="redirectFunction()">
    <h1>The People Mesh</h1>
    <p id="resultId"></p>
    <div>
        <h1 id="responseResult"></h1>
    </div>
</body>
<script>
    async function redirectFunction() {
        let currentUrl = window.location.href;
        let params = currentUrl.slice(44);
        let data = await getCallBack("http://127.0.0.1:8080/service/plugins/salesforce/settings/callback" + params);

        document.getElementById("responseResult").innerHTML = data["message"];
        document.getElementById("resultId").innerHTML = data["status"] + "\n" + data["message"];
    }
</script>

<script>
    async function getCallBack(url) {


        let auth_Headers = new Headers();
        auth_Headers.append("Content-Type", "application/json");

        let authrequest = {
            method: "GET",
            headers: auth_Headers,
            redirect: "follow",
        };

        const data = await fetch(url, authrequest)
            .then((response) =>
                response.text().then((result) => {
                    if (!response.ok) {
                        return {
                            status: "Failure",
                            code: response.status,
                            message: result,
                        };
                    } else {
                        return {
                            status: "Success",
                            code: response.status,
                            message: result
                        }
                    }
                })
            )
            .catch((error) => {
                return {
                    status: "Failure",
                    code: error.status,
                    message: error,
                };
            });
        return data;
    }


</script>

</html>