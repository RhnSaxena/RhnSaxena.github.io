<html>

<head>
    <title>Authorization</title>
</head>
<style>
    body {
        font-family: 'Roboto';
    }
</style>

<body onload="redirectFunction()">
    <div class="container-fluid">
        <div class="row" style="margin-top: 7rem;text-align: center;">
            <div class="col">
                <img src="./img/mesh-A.png">
                <!-- <h1>The People Mesh</h1> -->
            </div>
        </div>
        <div class="row" style="margin-top: 2rem;text-align: center;  color:rgb(204, 73, 73)">
            <div class="col">
                <h2 id="resultId">
                </h2>
            </div>
        </div>
        <div class="row" style="margin-top: 2rem;text-align: center; color:rgb(99, 25, 25)">
            <div>
                <div>
                    <h3 id="responseResult"></h3>
                </div>
            </div>
        </div>

    </div>


</body>
<script>
    async function redirectFunction() {
        let currentUrl = window.location.href;
        let params = currentUrl.slice(44);
        let data = await getCallBack("http://127.0.0.1:8080/service/plugins/salesforce/settings/callback" + params);

        document.getElementById("responseResult").innerHTML = data["message"]["message"];
        document.getElementById("resultId").innerHTML = data["status"] + "," + data["code"];
    }
</script>

<script>
    async function getCallBack(url) {


        let auth_Headers = new Headers();
        auth_Headers.append("Content-Type", "application/json");

        let authrequest = {
            method: "GET",
            headers: auth_Headers,
            redirect: "follow",
        };

        const data = await fetch(url, authrequest)
            .then((response) =>
                response.text().then((result) => {
                    if (!response.ok) {
                        return {
                            status: "Failure",
                            code: response.status,
                            message: JSON.parse(result),
                        };
                    } else {
                        return {
                            status: "Success",
                            code: response.status,
                            message: JSON.parse(result)
                        }
                    }
                })
            )
            .catch((error) => {
                return {
                    status: "Failure",
                    code: error.status,
                    message: error,
                };
            });
        return data;
    }


</script>

</html>